# =============================================================================
# Konfiguracja klastra OpenShift — Agent-Based Installer
# =============================================================================
# Użycie:
#   ansible-playbook generate-ocp-agent-iso.yml -e @group_vars/ocp_cluster1.yml
#
# Po wygenerowaniu ISO:
#   1. Upload ISO do PVC w OpenShift Virtualization
#   2. Podepnij ISO do VM jako CDROM
#   3. Zrestartuj VM — instalacja startuje automatycznie
# =============================================================================

# -----------------------------------------------------------------------------
# Ścieżki i katalogi
# -----------------------------------------------------------------------------
# Gdzie znajduje się openshift-install binary
openshift_install_binary: /usr/local/bin/openshift-install

# Katalog roboczy na pliki instalacyjne (install-config, agent-config, ISO)
install_dir: /tmp/ocp-install/{{ cluster_name }}

# Katalog z pull secret (plik JSON z console.redhat.com)
pull_secret_file: ~/.openshift/pull-secret.json

# Klucz SSH do wstrzyknięcia na nody (dla dostępu awaryjnego)
ssh_public_key_file: ~/.ssh/id_ed25519.pub

# -----------------------------------------------------------------------------
# Konfiguracja klastra
# -----------------------------------------------------------------------------
cluster_name: ocp1
base_domain: example.com

# Pełna nazwa klastra: ocp1.example.com
# API endpoint: api.ocp1.example.com
# Wildcard apps: *.apps.ocp1.example.com

# -----------------------------------------------------------------------------
# Sieć klastra
# -----------------------------------------------------------------------------
# Sieć maszyn (ta z Multus vlan214)
machine_network: 192.168.214.0/24

# Sieci wewnętrzne klastra (zazwyczaj nie trzeba zmieniać)
cluster_network_cidr: 10.128.0.0/14
cluster_network_prefix: 23
service_network_cidr: 172.30.0.0/16

# -----------------------------------------------------------------------------
# Konfiguracja hostów
# -----------------------------------------------------------------------------
# Adresy IP dla usług klastra (muszą być z machine_network)
api_vip: 192.168.214.100
ingress_vip: 192.168.214.101

# Serwer DNS i gateway
dns_server: 192.168.214.1
gateway: 192.168.214.1

# -----------------------------------------------------------------------------
# Definicje nodów
# -----------------------------------------------------------------------------
# MAC adresy weź z outputu create-virt-env.yml (interfejs vlan214)
#
# Dla klastra 3 master + 1 worker potrzebujesz 4 VM:
#   - worker-large-1 → master-0
#   - worker-large-2 → master-1
#   - worker-large-3 → master-2
#   - worker-large-4 → worker-0
#
# Minimalna konfiguracja:
#   - 3 mastery (control plane) — wymagane
#   - 0+ workerów — opcjonalne (workloady mogą działać na masterach)

nodes:
  # --- Control Plane (masters) ---
  - hostname: master-0
    role: master
    mac: "02:00:00:00:00:01"        # <- zmień na MAC z vlan214
    ip: 192.168.214.10
    # Opcjonalne nadpisanie zasobów (domyślnie bierze z VM)
    # root_disk: /dev/vda

  - hostname: master-1
    role: master
    mac: "02:00:00:00:00:02"        # <- zmień na MAC z vlan214
    ip: 192.168.214.11

  - hostname: master-2
    role: master
    mac: "02:00:00:00:00:03"        # <- zmień na MAC z vlan214
    ip: 192.168.214.12

  # --- Workers (opcjonalne) ---
  - hostname: worker-0
    role: worker
    mac: "02:00:00:00:00:04"        # <- zmień na MAC z vlan214
    ip: 192.168.214.20

  # Dodaj więcej workerów według potrzeb:
  # - hostname: worker-1
  #   role: worker
  #   mac: "02:00:00:00:00:05"
  #   ip: 192.168.214.21

# -----------------------------------------------------------------------------
# Opcje instalacji
# -----------------------------------------------------------------------------
# Typ platformy (none = bare metal / VM bez integracji z chmurą)
platform_type: none

# Wersja OpenShift (musi odpowiadać wersji openshift-install binary)
# openshift_version: 4.20

# SNO (Single Node OpenShift) — ustaw na true dla klastra 1-nodowego
single_node: false

# FIPS mode
fips_enabled: false
